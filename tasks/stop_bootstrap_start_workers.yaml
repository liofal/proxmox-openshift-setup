- name: Check bootstrap status before stopping
  command: sudo -n qm status {{ bootstrap.vmid + vmbase }}
  register: bootstrap_status
  changed_when: false

- name: Stop bootstrap node
  command: sudo -n qm stop {{ bootstrap.vmid + vmbase }}
  when: "'status: running' in bootstrap_status.stdout"

- name: Check worker node status
  command: sudo -n qm status {{ item.vmid + vmbase }}
  loop: "{{ workers }}"
  register: worker_status
  changed_when: false

- name: Start worker nodes
  command: sudo -n qm start {{ item.item.vmid + vmbase }}
  loop: "{{ worker_status.results }}"
  when: "'status: running' not in item.stdout"
